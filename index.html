<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 Dashboard</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 0; }
    h1 { text-align: center; padding: 20px; }
    section { padding: 20px; background: white; margin: 20px auto; width: 90%; max-width: 800px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    svg { background: lightgrey; display: block; margin: auto; }
    button { display: block; margin: 10px auto; padding: 10px 20px; }
  </style>
</head>
<body>
  <h1>D3.js Interactive Dashboard</h1>

  <section id="brushing">
    <h2>Brushing Interactivo</h2>
    <svg id="brush1" width="300" height="300"></svg>
    <svg id="brush2" width="300" height="300"></svg>
  </section>

  <section id="drag">
    <h2>Drag & Drop de Círculos</h2>
    <svg id="dragdrop" width="600" height="200">
      <circle cx="100" cy="100" r="20" fill="red" />
      <circle cx="300" cy="100" r="20" fill="green" />
      <circle cx="500" cy="100" r="20" fill="blue" />
    </svg>
  </section>

  <section id="stagger">
    <h2>Gráfico de Barras Stagger</h2>
    <button onclick="triggerStagger()">Animar</button>
    <svg id="stagger-svg" width="600" height="300"></svg>
  </section>

  <section id="lissajous">
    <h2>Curva de Lissajous</h2>
    <svg id="lissajous-svg" width="300" height="300"></svg>
  </section>

  <script>
    // === Datos simulados en JSON ===
    const data = [
      {"A": 20, "B": 50},
      {"A": 30, "B": 80},
      {"A": 40, "B": 10},
      {"A": 60, "B": 90},
      {"A": 10, "B": 40}
    ];

    // === Brushing Interactivo ===
    function makeBrush() {
      var svg1 = d3.select("#brush1"), svg2 = d3.select("#brush2");

      var sc1 = d3.scaleLinear().domain([0, 10, 100]).range(["lime", "yellow", "red"]);
      var sc2 = d3.scaleLinear().domain([0, 10, 100]).range(["lime", "yellow", "blue"]);

      var cs1 = drawCircles(svg1, data, d => +d.A * 3, d => +d.B * 2, sc1);
      var cs2 = drawCircles(svg2, data, d => +d.A * 3, d => +d.B * 2, sc2);

      svg1.call(installHandlers, data, cs1, cs2, sc1, sc2);
    }

    function drawCircles(svg, data, accX, accY, sc) {
      var color = sc(Infinity);
      return svg.selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("r", 5)
        .attr("cx", accX)
        .attr("cy", accY)
        .attr("fill", color)
        .attr("fill-opacity", 0.4);
    }

    function installHandlers(svg, data, cs1, cs2, sc1, sc2) {
      svg.attr("cursor", "crosshair")
        .on("mousemove", function(event) {
          var pt = d3.pointer(event);
          cs1.attr("fill", function(d, i) {
            var cx = +d3.select(this).attr("cx");
            var cy = +d3.select(this).attr("cy");
            var r = Math.hypot(pt[0] - cx, pt[1] - cy);
            data[i]["r"] = r;
            return sc1(r);
          });
          cs2.attr("fill", (d, i) => sc2(data[i]["r"]));
        })
        .on("mouseleave", function() {
          cs1.attr("fill", sc1(Infinity));
          cs2.attr("fill", sc2(Infinity));
        });
    }

    // === Drag & Drop ===
    function makeDragDrop() {
      var widget = undefined, color = undefined;

      var drag = d3.drag()
        .on("start", function() {
          color = d3.select(this).attr("fill");
          widget = d3.select(this).attr("fill", "lime");
        })
        .on("drag", function(event) {
          widget.attr("cx", event.x).attr("cy", event.y);
        })
        .on("end", function() {
          widget.attr("fill", color);
          widget = undefined;
        });

      drag(d3.select("#dragdrop").selectAll("circle"));
    }

    // === Staggered Bar Chart ===
    let ds1 = [2, 1, 3, 5, 7, 8, 9];
    let ds2 = [9, 8, 7, 5, 3, 2, 1];
    let toggle = false;

    function triggerStagger() {
      const svg = d3.select("#stagger-svg");
      const maxY = d3.max([...ds1, ...ds2]);
      const scX = d3.scaleLinear().domain([0, ds1.length]).range([50, 540]);
      const scY = d3.scaleLinear().domain([0, maxY]).range([250, 50]);

      let dataToUse = toggle ? ds2 : ds1;
      toggle = !toggle;

      let lines = svg.selectAll("line").data(dataToUse);

      lines.enter()
        .append("line")
        .merge(lines)
        .attr("stroke", "red")
        .attr("stroke-width", 20)
        .attr("x1", (d, i) => scX(i))
        .attr("x2", (d, i) => scX(i))
        .attr("y1", scY(0))
        .transition()
        .duration(1000)
        .delay((d, i) => 100 * i)
        .attr("y2", d => scY(d));
    }

    // === Lissajous Curve ===
    function makeLissajous() {
      var svg = d3.select("#lissajous-svg");
      var a = 1.9, b = 3.2;
      var phi, omega = 2 * Math.PI / 10000;

      var crrX = 150 + 100, crrY = 150;
      var prvX = crrX, prvY = crrY;

      var timer = d3.timer(function(t) {
        phi = omega * t;

        crrX = 150 + 100 * Math.cos(a * phi);
        crrY = 150 + 100 * Math.sin(b * phi);

        svg.selectAll("line")
          .each(function() { this.bogus_opacity *= 0.99; })
          .attr("stroke-opacity", function() { return this.bogus_opacity; })
          .filter(function() { return this.bogus_opacity < 0.05; })
          .remove();

        svg.append("line")
          .each(function() { this.bogus_opacity = 1.0; })
          .attr("x1", prvX).attr("y1", prvY)
          .attr("x2", crrX).attr("y2", crrY)
          .attr("stroke", "green").attr("stroke-width", 2);

        prvX = crrX;
        prvY = crrY;

        if (t > 20000) timer.stop();
      });
    }

    // === Inicializar todo ===
    makeBrush();
    makeDragDrop();
    makeLissajous();
  </script>
</body>
</html>
